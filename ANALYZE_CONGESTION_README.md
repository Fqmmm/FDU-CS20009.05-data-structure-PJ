# 拥堵系数分析工具使用说明

## 简介

`analyze_congestion.py` 是一个Python脚本，用于分析路网CSV文件中每条道路的拥堵情况。

## 功能特性

- 计算每条道路的BPR拥堵系数
- 统计拥堵系数的最大值、最小值、平均值
- 显示V/C比（流量/容量比）统计
- 显示时间延迟统计
- 找出最拥堵和最畅通的道路
- 显示拥堵等级分布

## 使用方法

### 基本用法

```bash
python analyze_congestion.py <csv_file_path>
```

### 示例

```bash
# 分析小规模测试用例
python analyze_congestion.py Test_Cases/test_cases/shanghai_test_cases/case1_simple/map_1200.csv

# 分析大规模测试用例
python analyze_congestion.py Test_Cases/large_scale_cases/large_scale_case_example/map_1200.csv

# 分析其他地图文件
python analyze_congestion.py Test_Cases/test_cases/shanghai_test_cases/case2_medium/map_0900.csv
```

## 输出说明

脚本会输出以下统计信息：

### 1. 基本信息
- 文件路径
- 道路总数

### 2. 拥堵系数统计
- 最小值：路网中最小的拥堵系数
- 最大值：路网中最大的拥堵系数
- 平均值：所有道路拥堵系数的平均值
- 变化范围：最大值与最小值的差异百分比

### 3. V/C比统计
- 流量容量比（Volume/Capacity）的统计数据

### 4. 时间延迟统计
- 由于拥堵导致的时间增加百分比

### 5. 最拥堵道路
- 道路详细信息
- 车辆数和容量
- 实际通行时间

### 6. 最畅通道路
- 道路详细信息
- 车辆数和容量
- 实际通行时间

### 7. 拥堵等级分布
- 畅通（系数<1.05）：延迟<5%
- 缓慢（1.05-1.15）：延迟5%-15%
- 拥堵（1.15-1.30）：延迟15%-30%
- 严重拥堵（≥1.30）：延迟≥30%

## BPR参数

脚本使用的BPR参数与C++代码保持一致：

- α (alpha) = 0.15
- β (beta) = 4.0
- 车道容量 = 1800 辆/小时/车道

**重要说明**：
- CSV文件中的"现有车辆数"表示道路上的车辆数（occupancy）
- BPR公式需要的是交通流量（flow，单位：veh/h）
- 脚本自动完成转换：flow = occupancy / travel_time_hours
- 这确保了V/C比的单位正确（veh/h / veh/h = 无量纲）

## 依赖

- Python 3.x
- 标准库（csv, sys, os）
- 无需安装第三方包

## 注意事项

1. CSV文件必须包含以下列（中文表头）：
   - 道路长度(米)
   - 道路限速(km/h)
   - 车道数
   - 现有车辆数

2. 文件编码应为UTF-8

3. Windows控制台可能显示中文乱码，但数据是正确的

## 输出示例

```
================================================================================
文件：Test_Cases/large_scale_cases/large_scale_case_example/map_1200.csv
道路总数：731
================================================================================

【拥堵系数统计】
  最小值：1.000000
  最大值：1.000051
  平均值：1.000003
  变化范围：0.01%

【流量/容量比 (V/C) 统计】
  最小值：0.002315
  最大值：0.016111
  平均值：0.006844

【时间延迟统计】
  最小延迟：0.00%
  最大延迟：0.01%
  平均延迟：0.00%

【最拥堵道路】
  道路ID：R0068
  路段：学校R → 学校Q
  车道数：1 车道
  车辆数：29 辆
  容量：1800 辆/小时
  V/C比：0.0161
  拥堵系数：1.000051
  时间延迟：+0.01%
  ...

【拥堵等级分布】
  畅通 (系数<1.05)：731 条 (100.0%)
  缓慢 (1.05-1.15)：0 条 (0.0%)
  拥堵 (1.15-1.30)：0 条 (0.0%)
  严重拥堵 (≥1.30)：0 条 (0.0%)
```

## 许可证

与主项目保持一致
